<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Query groups - Salsa</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="../mermaid.css">
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../about_salsa.html"><strong aria-hidden="true">1.</strong> About salsa</a></li><li class="chapter-item expanded affix "><li class="part-title">How to use Salsa</li><li class="chapter-item expanded "><a href="../how_to_use.html"><strong aria-hidden="true">2.</strong> How to use Salsa</a></li><li class="chapter-item expanded "><a href="../common_patterns.html"><strong aria-hidden="true">3.</strong> Common patterns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../common_patterns/selection.html"><strong aria-hidden="true">3.1.</strong> Selection</a></li><li class="chapter-item expanded "><a href="../common_patterns/on_demand_inputs.html"><strong aria-hidden="true">3.2.</strong> On-demand (Lazy) inputs</a></li></ol></li><li class="chapter-item expanded "><a href="../tuning.html"><strong aria-hidden="true">4.</strong> Tuning</a></li><li class="chapter-item expanded "><a href="../cycles.html"><strong aria-hidden="true">5.</strong> Cycle handling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cycles/fallback.html"><strong aria-hidden="true">5.1.</strong> Recovering via fallback</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">How Salsa works internally</li><li class="chapter-item expanded "><a href="../how_salsa_works.html"><strong aria-hidden="true">6.</strong> How Salsa works</a></li><li class="chapter-item expanded "><a href="../videos.html"><strong aria-hidden="true">7.</strong> Videos</a></li><li class="chapter-item expanded "><a href="../plumbing.html"><strong aria-hidden="true">8.</strong> Plumbing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plumbing/generated_code.html"><strong aria-hidden="true">8.1.</strong> Generated code</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plumbing/diagram.html"><strong aria-hidden="true">8.1.1.</strong> Diagram</a></li><li class="chapter-item expanded "><a href="../plumbing/query_groups.html" class="active"><strong aria-hidden="true">8.1.2.</strong> Query groups</a></li><li class="chapter-item expanded "><a href="../plumbing/database.html"><strong aria-hidden="true">8.1.3.</strong> Database</a></li></ol></li><li class="chapter-item expanded "><a href="../plumbing/salsa_crate.html"><strong aria-hidden="true">8.2.</strong> The salsa crate</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plumbing/query_ops.html"><strong aria-hidden="true">8.2.1.</strong> Query operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plumbing/maybe_changed_after.html"><strong aria-hidden="true">8.2.1.1.</strong> maybe changed after</a></li><li class="chapter-item expanded "><a href="../plumbing/fetch.html"><strong aria-hidden="true">8.2.1.2.</strong> Fetch</a></li></ol></li><li class="chapter-item expanded "><a href="../plumbing/derived_flowchart.html"><strong aria-hidden="true">8.2.2.</strong> Derived queries flowchart</a></li><li class="chapter-item expanded "><a href="../plumbing/cycles.html"><strong aria-hidden="true">8.2.3.</strong> Cycle handling</a></li></ol></li><li class="chapter-item expanded "><a href="../plumbing/terminology.html"><strong aria-hidden="true">8.3.</strong> Terminology</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../plumbing/terminology/backdate.html"><strong aria-hidden="true">8.3.1.</strong> Backdate</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/changed_at.html"><strong aria-hidden="true">8.3.2.</strong> Changed at</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/dependency.html"><strong aria-hidden="true">8.3.3.</strong> Dependency</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/derived_query.html"><strong aria-hidden="true">8.3.4.</strong> Derived query</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/durability.html"><strong aria-hidden="true">8.3.5.</strong> Durability</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/input_query.html"><strong aria-hidden="true">8.3.6.</strong> Input query</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/LRU.html"><strong aria-hidden="true">8.3.7.</strong> LRU</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/memo.html"><strong aria-hidden="true">8.3.8.</strong> Memo</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/query.html"><strong aria-hidden="true">8.3.9.</strong> Query</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/query_function.html"><strong aria-hidden="true">8.3.10.</strong> Query function</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/revision.html"><strong aria-hidden="true">8.3.11.</strong> Revision</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/untracked.html"><strong aria-hidden="true">8.3.12.</strong> Untracked dependency</a></li><li class="chapter-item expanded "><a href="../plumbing/terminology/verified.html"><strong aria-hidden="true">8.3.13.</strong> Verified</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Salsa RFCs</li><li class="chapter-item expanded "><a href="../rfcs.html"><strong aria-hidden="true">9.</strong> RFCs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rfcs/template.html"><strong aria-hidden="true">9.1.</strong> Template</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0001-Query-Group-Traits.html"><strong aria-hidden="true">9.2.</strong> RFC 0001: Query group traits</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0002-Intern-Queries.html"><strong aria-hidden="true">9.3.</strong> RFC 0002: Intern queries</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0003-Query-Dependencies.html"><strong aria-hidden="true">9.4.</strong> RFC 0003: Query dependencies</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0004-LRU.html"><strong aria-hidden="true">9.5.</strong> RFC 0004: LRU</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0005-Durability.html"><strong aria-hidden="true">9.6.</strong> RFC 0005: Durability</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0006-Dynamic-Databases.html"><strong aria-hidden="true">9.7.</strong> RFC 0006: Dynamic database</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0007-Opinionated-Cancelation.html"><strong aria-hidden="true">9.8.</strong> RFC 0007: Opinionated cancelation</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0008-Remove-Garbage-Collection.html"><strong aria-hidden="true">9.9.</strong> RFC 0008: Remove garbage collection</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0009-Cycle-recovery.html"><strong aria-hidden="true">9.10.</strong> RFC 0009: Cycle recovery</a></li><li class="chapter-item expanded "><a href="../rfcs/RFC0010-Slot-no-more.html"><strong aria-hidden="true">9.11.</strong> RFC 0010: Slot no more</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Appendices</li><li class="chapter-item expanded "><a href="../meta.html"><strong aria-hidden="true">10.</strong> Meta: about the book itself</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Salsa</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="query-groups-and-query-group-structs"><a class="header" href="#query-groups-and-query-group-structs">Query groups and query group structs</a></h1>
<p>When you define a query group trait:</p>
<pre><code class="language-rust ignore">#[salsa::query_group(HelloWorldStorage)]
trait HelloWorld {
    // For each query, we give the name, some input keys (here, we
    // have one key, `()`) and the output type `Arc&lt;String&gt;`. We can
    // use attributes to give other configuration:
    //
    // - `salsa::input` indicates that this is an &quot;input&quot; to the system,
    //   which must be explicitly set. The `salsa::query_group` method
    //   will autogenerate a `set_input_string` method that can be
    //   used to set the input.
    #[salsa::input]
    fn input_string(&amp;self, key: ()) -&gt; Arc&lt;String&gt;;

    // This is a *derived query*, meaning its value is specified by
    // a function (see Step 2, below).
    fn length(&amp;self, key: ()) -&gt; usize;
}
</code></pre>
<p>the <code>salsa::query_group</code> macro generates a number of things, shown in the sample
generated code below (details in the sections to come).</p>
<p>and associated storage struct) that represent things which don't have &quot;public&quot;
Note that there are a number of structs and types (e.g., the group descriptor
names. We currently generate mangled names with <code>__</code> afterwards, but those names
are not meant to be exposed to the user (ideally we'd use hygiene to enforce
this).</p>
<pre><code class="language-rust ignore">// First, a copy of the trait, though with extra supertraits and
// sometimes with some extra methods (e.g., `set_input_string`)
trait HelloWorld: 
    salsa::Database + 
    salsa::plumbing::HasQueryGroup&lt;HelloWorldStorage&gt;
{
    fn input_string(&amp;self, key: ()) -&gt; Arc&lt;String&gt;;
    fn set_input_string(&amp;mut self, key: (), value: Arc&lt;String&gt;);
    fn length(&amp;self, key: ()) -&gt; usize;
}

// Next, the &quot;query group struct&quot;, whose name was given by the
// user. This struct implements the `QueryGroup` trait which
// defines a few associated types common to the entire group.
struct HelloWorldStorage { }
impl salsa::plumbing::QueryGroup for HelloWorldStorage {
    type DynDb = dyn HelloWorld;
    type GroupStorage = HelloWorldGroupStorage__;
}

// Next, a blanket impl of the `HelloWorld` trait. This impl
// works for any database `DB` that implements the
// appropriate `HasQueryGroup`.
impl&lt;DB&gt; HelloWorld for DB
where
  DB: salsa::Database,
  DB: salsa::plumbing::HasQueryGroup&lt;HelloWorldStorage&gt;,
{
  ...
}

// Next, for each query, a &quot;query struct&quot; that represents it.
// The query struct has inherent methods like `in_db` and
// implements the `Query` trait, which defines various
// details about the query (e.g., its key, value, etc).
pub struct InputQuery { }
impl InputQuery { /* definition for `in_db`, etc */ }
impl salsa::Query for InputQuery {
    /* associated types */
}

// Same as above, but for the derived query `length`.
// For derived queries, we also implement `QueryFunction`
// which defines how to execute the query.
pub struct LengthQuery { }
impl salsa::Query for LengthQuery {
    ...
}
impl salsa::QueryFunction for LengthQuery {
    ...
}

// Finally, the group storage, which contains the actual
// hashmaps and other data used to implement the queries.
struct HelloWorldGroupStorage__ { .. }
</code></pre>
<h2 id="the-group-struct-and-querygroup-trait"><a class="header" href="#the-group-struct-and-querygroup-trait">The group struct and <code>QueryGroup</code> trait</a></h2>
<p>The group struct is the only thing we generate whose name is known to the user.
For a query group named <code>Foo</code>, it is conventionally called <code>FooStorage</code>, hence
the name <code>HelloWorldStorage</code> in our example.</p>
<p>Despite the name &quot;Storage&quot;, the struct itself has no fields. It exists only to
implement the <code>QueryGroup</code> trait. This <em>trait</em> has a number of associated types
that reference various bits of the query group, including the actual &quot;group
storage&quot; struct:</p>
<pre><code class="language-rust ignore">struct HelloWorldStorage { }
impl salsa::plumbing::QueryGroup for HelloWorldStorage {
    type DynDb = dyn HelloWorld;
    type GroupStorage = HelloWorldGroupStorage__; // generated struct
}
</code></pre>
<p>We'll go into detail on these types below and the role they play, but one that
we didn't mention yet is <code>GroupData</code>. That is a kind of hack used to manage
send/sync around slots, and it gets covered in the section on slots.</p>
<h2 id="impl-of-the-hello-world-trait"><a class="header" href="#impl-of-the-hello-world-trait">Impl of the hello world trait</a></h2>
<p>Ultimately, every salsa query group is going to be implemented by your final
database type, which is not currently known to us (it is created by combining
multiple salsa query groups). In fact, this salsa query group could be composed
into multiple database types. However, we want to generate the impl of the query-group
trait here in this crate, because this is the point where the trait definition is visible
and known to us (otherwise, we'd have to duplicate the method definitions).</p>
<p>So what we do is that we define a different trait, called <code>plumbing::HasQueryGroup&lt;G&gt;</code>,
that can be implemented by the database type. <code>HasQueryGroup</code> is generic over
the query group struct. So then we can provide an impl of <code>HelloWorld</code> for any
database type <code>DB</code> where <code>DB: HasQueryGroup&lt;HelloWorldStorage&gt;</code>. This
<code>HasQueryGroup</code> defines a few methods that, given a <code>DB</code>, give access to the
data for the query group and a few other things.</p>
<p>Thus we can generate an impl that looks like:</p>
<pre><code class="language-rust ignore">impl&lt;DB&gt; HelloWorld for DB
where
    DB: salsa::Database,
    DB: salsa::plumbing::HasQueryGroup&lt;HelloWorld&gt;
{
    ...
    fn length(&amp;self, key: ()) -&gt; Arc&lt;String&gt; {
      &lt;Self as salsa::plumbing::GetQueryTable&lt;HelloWorldLength__&gt;&gt;::get_query_table(self).get(())
    }
}
</code></pre>
<p>You can see that the various methods just hook into generic functions in the
<code>salsa::plumbing</code> module. These functions are generic over the query types
(<code>HelloWorldLength__</code>) that will be described shortly. The details of the &quot;query
table&quot; are covered in a future section, but in short this code pulls out the
hasmap for storing the <code>length</code> results and invokes the generic salsa logic to
check for a valid result, etc.</p>
<h2 id="for-each-query-a-query-struct"><a class="header" href="#for-each-query-a-query-struct">For each query, a query struct</a></h2>
<p>As we referenced in the previous section, each query in the trait gets a struct
that represents it. This struct is named after the query, converted into snake
case and with the word <code>Query</code> appended. In typical Salsa workflows, these
structs are not meant to be named or used, but in some cases it may be required.
For e.g. the <code>length</code> query, this structs might look something like:</p>
<pre><code class="language-rust ignore">struct LengthQuery { }
</code></pre>
<p>The struct also implements the <code>plumbing::Query</code> trait, which defines
a bunch of metadata about the query (and repeats, for convenience,
some of the data about the group that the query is in):</p>
<pre><code class="language-rust ignore">            impl salsa::Query for #qt
            {
                type Key = (#(#keys),*);
                type Value = #value;
                type Storage = #storage;

                const QUERY_INDEX: u16 = #query_index;

                const QUERY_NAME: &amp;'static str = #query_name;

                fn query_storage&lt;'a&gt;(
                    group_storage: &amp;'a &lt;Self as salsa::QueryDb&lt;'_&gt;&gt;::GroupStorage,
                ) -&gt; &amp;'a std::sync::Arc&lt;Self::Storage&gt; {
                    &amp;group_storage.#fn_name
                }

                fn query_storage_mut&lt;'a&gt;(
                    group_storage: &amp;'a &lt;Self as salsa::QueryDb&lt;'_&gt;&gt;::GroupStorage,
                ) -&gt; &amp;'a std::sync::Arc&lt;Self::Storage&gt; {
                    &amp;group_storage.#fn_name
                }
            }
</code></pre>
<p>Depending on the kind of query, we may also generate other impls, such as an
impl of <code>salsa::plumbing::QueryFunction</code>, which defines the methods for
executing the body of a query. This impl would then include a call to the user's
actual function.</p>
<pre><code class="language-rust ignore">                impl salsa::plumbing::QueryFunction for #qt
                {
                    fn execute(db: &amp;&lt;Self as salsa::QueryDb&lt;'_&gt;&gt;::DynDb, #key_pattern: &lt;Self as salsa::Query&gt;::Key)
                        -&gt; &lt;Self as salsa::Query&gt;::Value {
<span class="boring">                        invoke(db, #(#key_names),*)
</span>                    }

<span class="boring">                    recover
</span>                }
</code></pre>
<h2 id="group-storage"><a class="header" href="#group-storage">Group storage</a></h2>
<p>The &quot;group storage&quot; is the actual struct that contains all the hashtables and
so forth for each query. The types of these are ultimately defined by the
<code>Storage</code> associated type for each query type. The struct is generic over the
final database type:</p>
<pre><code class="language-rust ignore">struct HelloWorldGroupStorage__ {
    input: &lt;InputQuery as Query::Storage,
    length: &lt;LengthQuery as Query&gt;::Storage,
}
</code></pre>
<p>We also generate some inherent methods. First, a <code>new</code> method that takes
the group index as a parameter and passes it along to each of the query
storage <code>new</code> methods:</p>
<pre><code class="language-rust ignore">        impl #group_storage {
<span class="boring">            trait_vis fn new(group_index: u16) -&gt; Self {
</span><span class="boring">                group_storage {
</span><span class="boring">                    (
</span><span class="boring">                        queries_with_storage:
</span>                        std::sync::Arc::new(salsa::plumbing::QueryStorageOps::new(group_index)),
                    )*
                }
            }
        }
</code></pre>
<p>And then various methods that will dispatch from a <code>DatabaseKeyIndex</code> that
corresponds to this query group into the appropriate query within the group.
Each has a similar structure of matching on the query index and then delegating
to some method defined by the query storage:</p>
<pre><code class="language-rust ignore">        impl #group_storage {
<span class="boring">            trait_vis fn fmt_index(
</span>                &amp;self,
                db: &amp;(#dyn_db + '_),
                input: salsa::DatabaseKeyIndex,
                fmt: &amp;mut std::fmt::Formatter&lt;'_&gt;,
            ) -&gt; std::fmt::Result {
                match input.query_index() {
<span class="boring">                    fmt_ops
</span>                    i =&gt; panic!(&quot;salsa: impossible query index {}&quot;, i),
                }
            }

<span class="boring">            trait_vis fn maybe_changed_after(
</span>                &amp;self,
                db: &amp;(#dyn_db + '_),
                input: salsa::DatabaseKeyIndex,
                revision: salsa::Revision,
            ) -&gt; bool {
                match input.query_index() {
<span class="boring">                    maybe_changed_ops
</span>                    i =&gt; panic!(&quot;salsa: impossible query index {}&quot;, i),
                }
            }

<span class="boring">            trait_vis fn cycle_recovery_strategy(
</span>                &amp;self,
                db: &amp;(#dyn_db + '_),
                input: salsa::DatabaseKeyIndex,
            ) -&gt; salsa::plumbing::CycleRecoveryStrategy {
                match input.query_index() {
<span class="boring">                    cycle_recovery_strategy_ops
</span>                    i =&gt; panic!(&quot;salsa: impossible query index {}&quot;, i),
                }
            }

<span class="boring">            trait_vis fn for_each_query(
</span>                &amp;self,
                _runtime: &amp;salsa::Runtime,
                mut op: &amp;mut dyn FnMut(&amp;dyn salsa::plumbing::QueryStorageMassOps),
            ) {
<span class="boring">                for_each_ops
</span>            }
        }
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../plumbing/diagram.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../plumbing/database.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../plumbing/diagram.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../plumbing/database.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
                <script type="text/javascript" src="../mermaid.min.js"></script>
                <script type="text/javascript" src="../mermaid-init.js"></script>
        
        
    </body>
</html>
